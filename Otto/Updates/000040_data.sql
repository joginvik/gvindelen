SET SQL DIALECT 3;

SET NAMES WIN1251;

SET CLIENTLIB 'fbclient.dll';


INSERT INTO OBJECTS (OBJECT_SIGN, OBJECT_NAME, TABLE_NAME, IDFIELD_NAME, ATTR_TABLE_NAME, PROCEDURE_READ)
  VALUES ('MONEYBACK', 'Возвраты денег', 'MONEYBACKS', 'MONEYBACK_ID', 'MONEYBACK_ATTRS', 'MONEYBACK_READ');



UPDATE ACTIONCODES
SET PROCEDURE_NAME = 'ACCOUNT_CREDIT'
WHERE (ACTION_SIGN = 'ACCOUNT_CREDIT');

INSERT INTO ACTIONCODES (ACTION_SIGN, ACTION_NAME, OBJECT_SIGN, PROCEDURE_NAME)
  VALUES ('ACCOUNT_CREDIT_BYR', 'Кредиторская задолженность BYR', 'ACCOUNT', 'ACCOUNT_CREDIT');

INSERT INTO ACTIONCODES (ACTION_SIGN, ACTION_NAME, OBJECT_SIGN, PROCEDURE_NAME)
  VALUES ('ACCOUNT_CREDIT_EUR', 'Кредиторская задолженность EUR', 'ACCOUNT', 'ACCOUNT_CREDIT');

INSERT INTO ACTIONCODES (ACTION_SIGN, ACTION_NAME, OBJECT_SIGN, PROCEDURE_NAME)
  VALUES ('MONEYBACK_APPROVE', 'Подтвердить возврат денег', 'MONEYBACK', 'MONEYBACK_STORE');

INSERT INTO ACTIONCODES (ACTION_SIGN, ACTION_NAME, OBJECT_SIGN, PROCEDURE_NAME)
  VALUES ('MONEYBACK_CREATE', 'Создать возврат денег', 'MONEYBACK', 'MONEYBACK_STORE');


INSERT INTO ACTIONCODE_CRITERIAS (ACTIONCODE_SIGN, PARAM_NAME, PARAM_KIND, PARAM_ACTION, PARAM_VALUE_1, PARAM_VALUE_2)
  VALUES ('ACCOUNT_CREDIT_EUR', 'AMOUNT_EUR', 'N', '>', '0', NULL);

INSERT INTO ACTIONCODE_CRITERIAS (ACTIONCODE_SIGN, PARAM_NAME, PARAM_KIND, PARAM_ACTION, PARAM_VALUE_1, PARAM_VALUE_2)
  VALUES ('MONEYBACK_CREATE', 'AMOUNT_BYR', 'N', '>', '0', NULL);



UPDATE ACTIONCODE_PARAMS
SET PARAM_VALUE = 'Списание средств на заявку [ORDER_CODE]'
WHERE (ACTION_SIGN = 'ACCOUNT_CREDITORDER') AND (PARAM_NAME = 'NOTES') AND (PARAM_KIND = 'V');

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ACCOUNT_CREDITORDER', 'ORDER_CODE', 'F', 'select order_code from orders where order_id = [ORDER_ID]');

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ACCOUNT_CREDIT_BYR', 'AMOUNT_BYR', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ACCOUNT_CREDIT_BYR', 'ID', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ACCOUNT_CREDIT_EUR', 'AMOUNT_EUR', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ACCOUNT_CREDIT_EUR', 'ID', 'I', NULL);

UPDATE ACTIONCODE_PARAMS
SET PARAM_VALUE = 'Зачисление средств с заявки [ORDER_CODE]'
WHERE (ACTION_SIGN = 'ACCOUNT_DEBITORDER') AND (PARAM_NAME = 'NOTES') AND (PARAM_KIND = 'V');

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ACCOUNT_DEBITORDER', 'ORDER_CODE', 'F', 'select order_code from orders where order_id = [ORDER_ID]');

UPDATE ACTIONCODE_PARAMS
SET PARAM_VALUE = 'Ручное списание cуммы [AMOUNT_EUR] EUR со счета по курсу [BYR2EUR] [ANNOTATE]'
WHERE (ACTION_SIGN = 'ACCOUNT_MANUALCREDIT') AND (PARAM_NAME = 'NOTES') AND (PARAM_KIND = 'V');

UPDATE ACTIONCODE_PARAMS
SET PARAM_VALUE = 'Ручное зачисление cуммы [AMOUNT_EUR] EUR на счет по курсу [BYR2EUR] [ANNOTATE]'
WHERE (ACTION_SIGN = 'ACCOUNT_MANUALDEBIT') AND (PARAM_NAME = 'NOTES') AND (PARAM_KIND = 'V');

UPDATE ACTIONCODE_PARAMS
SET PARAM_VALUE = 'Зачиление платежа [AMOUNT_BYR] BYR по заявке [ORDER_CODE] на сумму [AMOUNT_EUR] по курсу [BYR2EUR]'
WHERE (ACTION_SIGN = 'ACCOUNT_PAYMENTIN') AND (PARAM_NAME = 'NOTES') AND (PARAM_KIND = 'V');

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('MONEYBACK_APPROVE', 'ID', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('MONEYBACK_APPROVE', 'NEW.STATUS_SIGN', 'V', 'APPROVED');

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('MONEYBACK_CREATE', 'ACCOUNT_ID', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('MONEYBACK_CREATE', 'AMOUNT_BYR', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('MONEYBACK_CREATE', 'KIND', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('MONEYBACK_CREATE', 'PURPOSE', 'X', 'PURPOSE');

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ORDER_HAVERETURN', 'ID', 'I', NULL);

INSERT INTO ACTIONCODE_PARAMS (ACTION_SIGN, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES ('ORDER_HAVERETURN', 'MONEYBACK_KIND', 'I', NULL);



INSERT INTO ACTIONTREE (ACTIONTREEITEM_ID, ACTION_SIGN, ORDER_NO, CHILD_ACTION)
  VALUES (63, 'ORDER_HAVERETURN', 3, 'MONEYBACK_CREATE');

INSERT INTO ACTIONTREE (ACTIONTREEITEM_ID, ACTION_SIGN, ORDER_NO, CHILD_ACTION)
  VALUES (65, 'MONEYBACK_CREATE', 1, 'ACCOUNT_CREDIT_BYR');



INSERT INTO ACTIONTREE_PARAMS (ACTIONTREEITEM_ID, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES (62, 'AMOUNT_BYR', 'O', 'AMOUNT_BYR');

INSERT INTO ACTIONTREE_PARAMS (ACTIONTREEITEM_ID, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES (63, 'ACCOUNT_ID', 'A', 'ACCOUNT_ID');

INSERT INTO ACTIONTREE_PARAMS (ACTIONTREEITEM_ID, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES (63, 'AMOUNT_BYR', 'A', 'AMOUNT_BYR');

INSERT INTO ACTIONTREE_PARAMS (ACTIONTREEITEM_ID, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES (63, 'KIND', 'A', 'MONEYBACK_KIND');

INSERT INTO ACTIONTREE_PARAMS (ACTIONTREEITEM_ID, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES (63, 'ORDER_ID', 'A', 'ID');

INSERT INTO ACTIONTREE_PARAMS (ACTIONTREEITEM_ID, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES (65, 'AMOUNT_BYR', 'A', 'AMOUNT_BYR');

INSERT INTO ACTIONTREE_PARAMS (ACTIONTREEITEM_ID, PARAM_NAME, PARAM_KIND, PARAM_VALUE)
  VALUES (65, 'ID', 'A', 'ACCOUNT_ID');



INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (701, 'ORDER', 'MONEYBACK_KIND', 'Тип возврата денег', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (724, 'ORDER', 'INVOICE_EUR_0', 'Сумма извещения в EUR', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (725, 'ORDER', 'INVOICE_BYR_0', 'Сумма извещения в BYR', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (726, 'ORDER', 'INVOICE_EUR_1', 'Старая сумма извещения в EUR', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (727, 'ORDER', 'INVOICE_BYR_1', 'Старая сумма извещения в BYR', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (728, 'ORDER', 'INVOICE_EUR_2', 'Старая сумма извещения в EUR', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (729, 'ORDER', 'INVOICE_BYR_2', 'Старая сумма извещения в BYR', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (919, 'ORDERITEM', 'NRRETCODE', 'Код для возврата', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (942, 'ORDERITEM', 'RETURN_REESTR_ID', 'ID реестра возврата', 'RETURN_REESTR_ID', NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1305, 'TAXRATE', 'PARAM_NAME', 'Имя параметра с суммой', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1400, 'MONEYBACK', 'STATUS_ID', 'Id состояния', 'STATUS_ID', NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1401, 'MONEYBACK', 'ACCOUNT_ID', 'Id Счета', 'ACCOUNT_ID', NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1402, 'MONEYBACK', 'AMOUNT_BYR', 'Возвращаемая сумма EUR', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1403, 'MONEYBACK', 'MONEYBACK_KIND', 'Способ возврата денег', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1404, 'MONEYBACK', 'BELPOST_BAR_CODE', 'Код посылки БелПочты', NULL, NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1405, 'MONEYBACK', 'STATUS_SIGN', 'Сигнатура состояния', NULL, 'R');

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1406, 'MONEYBACK', 'KIND', 'Тип возврата', 'KIND', NULL);

INSERT INTO ATTRS (ATTR_ID, OBJECT_SIGN, ATTR_SIGN, ATTR_NAME, FIELD_NAME, DIRECTION)
  VALUES (1412, 'MONEYBACK', 'PURPOSE', 'Описание платежа', NULL, NULL);

UPDATE ATTRS
SET DIRECTION = NULL
WHERE (ATTR_ID = 1501);



INSERT INTO STATUSES (STATUS_ID, STATUS_NAME, OBJECT_SIGN, IS_DEFAULT, STATUS_SIGN, ACTION_SIGN, FLAG_SIGN_LIST, STORE_DATE, ISSTATE)
  VALUES (243, 'Новый', 'MONEYBACK', 1, 'NEW', 'MONEYBACK_CREATE', NULL, NULL, 0);

INSERT INTO STATUSES (STATUS_ID, STATUS_NAME, OBJECT_SIGN, IS_DEFAULT, STATUS_SIGN, ACTION_SIGN, FLAG_SIGN_LIST, STORE_DATE, ISSTATE)
  VALUES (244, 'Реестр сформирован', 'MONEYBACK', NULL, 'APPROVED', NULL, NULL, NULL, 0);

UPDATE STATUSES
SET FLAG_SIGN_LIST = ',CREDIT,'
WHERE (STATUS_ID = 278);

UPDATE STATUSES
SET FLAG_SIGN_LIST = ',BALANCEABLE,'
WHERE (STATUS_ID = 279);

INSERT INTO STATUSES (STATUS_ID, STATUS_NAME, OBJECT_SIGN, IS_DEFAULT, STATUS_SIGN, ACTION_SIGN, FLAG_SIGN_LIST, STORE_DATE, ISSTATE)
  VALUES (284, 'Деньги отправлены', 'ORDER', NULL, 'MONEYSENT', NULL, NULL, NULL, 1);


INSERT INTO FLAGS2STATUSES (STATUS_ID, FLAG_SIGN)
  VALUES (217, 'BALANCEABLE');

INSERT INTO FLAGS2STATUSES (STATUS_ID, FLAG_SIGN)
  VALUES (278, 'CREDIT');

INSERT INTO FLAGS2STATUSES (STATUS_ID, FLAG_SIGN)
  VALUES (279, 'BALANCEABLE');


INSERT INTO TEMPLATES (TEMPLATE_ID, FILENAME_MASK, PLUGIN_NAME)
  VALUES (11, '%', 'Исходящий реестр');



INSERT INTO SETTINGSIGNS (SETTING_SIGN, SETTING_NAME, DATATYPE_SIGN)
  VALUES ('BANK_FEE', 'Комиссия при банковском переводе', 'I');

INSERT INTO SETTINGSIGNS (SETTING_SIGN, SETTING_NAME, DATATYPE_SIGN)
  VALUES ('BELPOST_FEE', 'Комиссия БелПочты', 'I');

INSERT INTO SETTINGSIGNS (SETTING_SIGN, SETTING_NAME, DATATYPE_SIGN)
  VALUES ('NDS_FEE', 'НДС', 'I');



INSERT INTO STATUS_RULES (OLD_STATUS_ID, NEW_STATUS_ID, ACTION_SIGN)
  VALUES (186, 277, 'ORDERITEM_DISCARD');

INSERT INTO STATUS_RULES (OLD_STATUS_ID, NEW_STATUS_ID, ACTION_SIGN)
  VALUES (243, 244, 'MONEYBACK_APPROVE');



INSERT INTO TAXSERVS (TAXSERV_ID, TAXSERV_NAME, STATUS_ID, CALCPOINT_ID)
  VALUES (5, 'Бонус', 121, 3);



INSERT INTO TAXRATES (TAXRATE_ID, TAXSERV_ID, TAXPLAN_ID, TAX_PROCEDURE, STATUS_ID)
  VALUES (14, 5, 3, 'TAX_ENTERED_SUM', 131);

INSERT INTO TAXRATES (TAXRATE_ID, TAXSERV_ID, TAXPLAN_ID, TAX_PROCEDURE, STATUS_ID)
  VALUES (15, 5, 4, 'TAX_ENTERED_SUM', 131);



UPDATE TAXRATE_ATTRS
SET ATTR_VALUE = '8'
WHERE (OBJECT_ID = 1) AND (ATTR_ID = 1301);

UPDATE TAXRATE_ATTRS
SET ATTR_VALUE = '8'
WHERE (OBJECT_ID = 5) AND (ATTR_ID = 1301);

INSERT INTO TAXRATE_ATTRS (OBJECT_ID, ATTR_ID, ATTR_VALUE)
  VALUES (14, 1305, 'BONUS_EUR');

INSERT INTO TAXRATE_ATTRS (OBJECT_ID, ATTR_ID, ATTR_VALUE)
  VALUES (15, 1305, 'BONUS_EUR');


DELETE FROM RECODES
WHERE (OBJECT_SIGN = 'ARTICLE') AND (ATTR_SIGN = 'DIMENSION_ENCODE') AND (ORIGINAL_VALUE = 'XXXL');
DELETE FROM RECODES
WHERE (OBJECT_SIGN = 'ARTICLE') AND (ATTR_SIGN = 'DIMENSION_ENCODE') AND (ORIGINAL_VALUE = 'XXXS');


DELETE FROM ATTRS
WHERE (ATTR_ID = 735);
DELETE FROM ATTRS
WHERE (ATTR_ID = 736);


DELETE FROM ACTIONTREE_PARAMS
WHERE (ACTIONTREEITEM_ID = 62) AND (PARAM_NAME = 'AMOUNT_EUR') AND (PARAM_KIND = 'F');


DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_CREDIT') AND (PARAM_NAME = 'AMOUNT_EUR') AND (PARAM_KIND = 'I');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_CREDIT') AND (PARAM_NAME = 'AMOUNT_EUR') AND (PARAM_KIND = 'W');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_CREDIT') AND (PARAM_NAME = 'BALANCE_EUR') AND (PARAM_KIND = 'W');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_CREDIT') AND (PARAM_NAME = 'ID') AND (PARAM_KIND = 'I');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_CREDIT') AND (PARAM_NAME = 'REST_EUR') AND (PARAM_KIND = 'W');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_CREDIT') AND (PARAM_NAME = 'SIGN') AND (PARAM_KIND = 'V');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_DEBIT') AND (PARAM_NAME = 'AMOUNT_EUR') AND (PARAM_KIND = 'W');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_DEBIT') AND (PARAM_NAME = 'BALANCE_EUR') AND (PARAM_KIND = 'W');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_DEBIT') AND (PARAM_NAME = 'REST_EUR') AND (PARAM_KIND = 'W');
DELETE FROM ACTIONCODE_PARAMS
WHERE (ACTION_SIGN = 'ACCOUNT_DEBITORDER') AND (PARAM_NAME = 'AMOUNT_EUR') AND (PARAM_KIND = 'I');


DELETE FROM ACTIONCODE_CRITERIAS
WHERE (ACTIONCODE_SIGN = 'ACCOUNT_CREDIT') AND (PARAM_NAME = 'AMOUNT_EUR');


