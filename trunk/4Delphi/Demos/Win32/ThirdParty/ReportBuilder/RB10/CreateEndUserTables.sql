DROP TABLE RB_FOLDER;
DROP GENERATOR FOLDER_ID_GEN;
DROP TABLE RB_ITEM;
DROP GENERATOR ITEM_ID_GEN;
DROP TABLE RB_TABLE;
DROP TABLE RB_FIELD;
DROP TABLE RB_JOIN;


CREATE TABLE RB_FOLDER (
  FOLDER_ID INTEGER DEFAULT 0,
  FOLDER_NAME CHAR(60),
  PARENT_ID INTEGER DEFAULT 0 );

CREATE INDEX FOLDER_IDX ON RB_FOLDER (FOLDER_ID);
CREATE INDEX PARENT_IDX ON RB_FOLDER (PARENT_ID);

CREATE GENERATOR FOLDER_ID_GEN;

CREATE TABLE RB_ITEM (
  ITEM_ID INTEGER DEFAULT 0 ,
  FOLDER_ID INTEGER DEFAULT 0,
  ITEM_NAME CHAR(60),
  ITEM_SIZE INTEGER DEFAULT 0,
  ITEM_TYPE INTEGER DEFAULT 0,
  MODIFIED INTEGER,
  DELETED INTEGER,
  TEMPLATE BLOB);

CREATE INDEX ITEM_IDX ON RB_ITEM (ITEM_ID);
CREATE INDEX FOLDER_ITEM_NAME_IDX ON RB_ITEM (FOLDER_ID, ITEM_TYPE, ITEM_NAME);

CREATE GENERATOR ITEM_ID_GEN;

CREATE TABLE RB_TABLE (
  TABLE_NAME VARCHAR(60) NOT NULL,
  TABLE_ALIAS VARCHAR(60)) ;

CREATE INDEX RB_TABLE_NAME_IDX ON RB_TABLE (TABLE_NAME);


CREATE TABLE RB_FIELD (
  TABLE_NAME VARCHAR(60) NOT NULL,
  FIELD_NAME VARCHAR(60) NOT NULL,
  FIELD_ALIAS VARCHAR(60),
  DATATYPE VARCHAR(60),
  SELECTABLE VARCHAR(1),
  SEARCHABLE VARCHAR(1),
  SORTABLE VARCHAR(1),
  AUTOSEARCH VARCHAR(1),
  MANDATORY VARCHAR(1));

CREATE INDEX RB_TABLE_FIELD_NAME_IDX ON RB_FIELD (TABLE_NAME, FIELD_NAME);


CREATE TABLE RB_JOIN (
  TABLE_NAME1 VARCHAR(60) NOT NULL,
  TABLE_NAME2 VARCHAR(60) NOT NULL,
  JOIN_TYPE VARCHAR(60),
  FIELD_NAMES1 VARCHAR(255),
  OPERATORS VARCHAR(60),
  FIELD_NAMES2 VARCHAR(255));

CREATE INDEX RB_TABLE1_TABLE2_IDX ON rb_join (TABLE_NAME1, TABLE_NAME2);

SET TERM ^ ;

CREATE TRIGGER SET_FOLDER_ID FOR RB_FOLDER AFTER INSERT AS
BEGIN
  NEW.FOLDER_ID = GEN_ID(FOLDER_ID_GEN, 1);
END;
^

CREATE TRIGGER SET_ITEM_ID FOR RB_ITEM AFTER INSERT AS
BEGIN
  NEW.ITEM_ID = GEN_ID(ITEM_ID_GEN, 1);
END;
^

SET TERM ; ^
